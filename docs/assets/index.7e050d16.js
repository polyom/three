var w=Object.defineProperty;var m=(r,t,e)=>t in r?w(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(m(r,typeof t!="symbol"?t+"":t,e),e);import{O as g,W as y,S as k,P as L,G as l,L as x,B as S,V as u,a as P,M as v,b as R,c as b,d as A,p as z,R as E,E as M,e as O,C}from"./vendor.2fbbcef6.js";const D=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}};D();g.prototype.update=()=>{};class J{constructor(){o(this,"renderer",new y({antialias:!0}));o(this,"scene",new k);o(this,"camera",new L);this.resize(),window.addEventListener("resize",()=>this.resize()),this.renderer.setAnimationLoop(this.loop.bind(this)),this.renderer.setPixelRatio(window.devicePixelRatio)}resize(t=window.innerWidth,e=window.innerHeight){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}loop(){this.renderer.render(this.scene,this.camera),this.scene.traverse(t=>t.update())}}class Z extends l{constructor(t,e){super();o(this,"line");const s=new x({color:16777215}),i=new S().setFromPoints([new u(-.5,0),new u(-.5,-e+.5),new u(t-.5,-e+.5),new u(t-.5,.5)]);this.line=new P(i,s),this.add(this.line),this.line.add}}const f=.7;class B extends v{constructor(){const t=new R(f,f,f),e=new b({wireframe:!0});super(t,e);o(this,"x",0);o(this,"y",0);o(this,"speed",.6)}set(t,e,s=!1){this.x=t,this.y=e,s&&this.position.set(t,e,0)}update(){this.translateX((this.x-this.position.x)*this.speed),this.translateY((this.y-this.position.y)*this.speed)}}class T extends l{constructor(t,e,s){super();o(this,"cubes",[]);o(this,"pivot",new l);o(this,"offset",new l);o(this,"offset2",new l);o(this,"x",0);o(this,"y",0);o(this,"d",0);o(this,"speed",.6);this.offset.position.set(-e,s,0),this.offset2.position.set(e,-s,0),this.cubes=t.map(([i,n])=>{const h=new B;return h.set(i,-n,!0),h}),this.add(this.offset),this.offset.add(this.pivot),this.pivot.add(this.offset2),this.offset2.add(...this.cubes)}set(t,e,s,i=!1){this.x=t,this.y=e,this.d=s,i&&(this.position.set(t,e,0),this.pivot.rotation.set(0,0,-s*Math.PI/2))}update(){this.translateX((this.x-this.position.x)*this.speed),this.translateY((this.y-this.position.y)*this.speed),this.pivot.rotation.z+=(-this.d*Math.PI/2-this.pivot.rotation.z)*this.speed}}class _ extends l{constructor(t,e){super();o(this,"cursor");o(this,"queue",[]);o(this,"held");o(this,"frame");o(this,"stack");o(this,"printLocations",[]);this.width=t,this.height=e,this.stack=Array(e).fill(null).map(()=>Array(t).fill(null)),this.frame=new Z(t,e),this.add(this.frame)}updateQueuePosition(){this.queue.forEach((t,e)=>{t.set(this.width+2,-e*4,0)})}push(t,e,s){const i=new T(t,e,s),n=this.queue.push(i);i.set(this.width+2,-n*4,0,!0),this.add(i),this.updateQueuePosition()}print(t,e){this.printLocations.push([t,e])}lock(t){var e;(e=this.cursor)==null||e.cubes.forEach((s,i)=>{this.add(s);const[n,h]=this.printLocations[i];s.set(n,this.cursor.position.y-this.cursor.y-h,!0),s.set(n,-h),this.stack[h][n]=s}),this.printLocations=[],this.clearLines(t)}spawn(t,e,s){this.cursor=this.queue.shift(),this.updateQueuePosition(),this.cursor.set(t,e,s)}swap(t,e){var i;const s=this.held;this.held=this.cursor,this.cursor=s,this.held.set(-4,0,0),(i=this.cursor)==null||i.set(t,e,0)}clearLines(t){for(const e of t){console.log(this.stack[e]);for(const s of this.stack[e])s.removeFromParent();this.stack.splice(e,1),this.stack.unshift(Array(this.width).fill(null))}this.updateStackPosition()}updateStackPosition(){this.stack.forEach((t,e)=>{for(const s of t)s==null||s.set(s.x,-e)})}}const q={size:[10,20],spawns:[[3,0],[3,-1],[3,-2],[3,-3]],kicks:{I:[{left:[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],right:[[0,0],[-2,0],[1,0],[-2,-1],[1,2]]},{left:[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],right:[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]},{left:[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],right:[[0,0],[2,0],[-1,0],[2,1],[-1,-2]]},{left:[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],right:[[0,0],[1,0],[-2,0],[1,-2],[-2,1]]}],JLTSZ:[{left:[[0,0],[1,0],[1,1],[0,-2],[1,-2]],right:[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]},{left:[[0,0],[1,0],[1,-1],[0,2],[1,2]],right:[[0,0],[1,0],[1,-1],[0,2],[1,2]]},{left:[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],right:[[0,0],[1,0],[1,1],[0,-2],[1,-2]]},{left:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],right:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]}],O:[{left:[[0,0]],right:[[0,0]]},{left:[[0,0]],right:[[0,0]]},{left:[[0,0]],right:[[0,0]]},{left:[[0,0]],right:[[0,0]]}]},pieces:[{shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],kicks:"I"},{shape:[[1,0,0],[1,1,1],[0,0,0]],kicks:"JLTSZ"},{shape:[[0,0,1],[1,1,1],[0,0,0]],kicks:"JLTSZ"},{offset:[1,0],shape:[[1,1],[1,1]],kicks:"O"},{shape:[[0,1,1],[1,1,0],[0,0,0]],kicks:"JLTSZ"},{shape:[[0,1,0],[1,1,1],[0,0,0]],kicks:"JLTSZ"},{shape:[[1,1,0],[0,1,1],[0,0,0]],kicks:"JLTSZ"}]},F=new A(...z(q),new E(1,2,3,4),10),a=new M(F,500),p=new J;new O(p.camera,p.renderer.domElement);document.body.appendChild(p.renderer.domElement);const d=new _(a.state.width,a.state.height);p.scene.add(d);p.camera.translateZ(30);a.on("move",([r,t,e],s)=>{s&&d.cursor&&d.cursor.set(r,-t,e,!1)});a.on("spawn",(r,t)=>{if(!t)return;const{x:e,y:s,angle:i}=a.state;d.spawn(e,s,i)});a.on("lock",(r,t)=>{d.lock(t)});a.on("push",([r])=>{const[t,e]=a.state.getPiece(r).size;d.push(a.state.getShape(r,0),-(t-1)/2,-(e-1)/2)});a.on("swap",()=>{d.swap(a.state.x,a.state.y)});a.on("print",([r,t,e])=>{d.print(r,t)});a.start();a.state.spawn();const c=new C(a,{das:150,arr:20,dcd:6,crt:!0,sdf:10});window.onkeydown=({key:r})=>{switch(r){case"ArrowLeft":return c.startSlideLeft();case"ArrowRight":return c.startSlideRight();case"c":return c.startHold();case" ":return c.startHardDrop();case"z":return c.startRotateLeft();case"ArrowUp":case"x":return c.startRotateRight();case"ArrowDown":return c.startSoftDrop()}};window.onkeyup=({key:r})=>{switch(r){case"ArrowLeft":return c.stopSlideLeft();case"ArrowRight":return c.stopSlideRight();case"ArrowDown":return c.stopSoftDrop();case"z":return c.stopRotateLeft();case"ArrowUp":case"x":return c.stopRotateRight();case"c":return c.stopHold();case" ":return c.stopHardDrop()}};
